<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BookHive MVP</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, button { padding: 10px; margin: 5px; font-size: 1rem; }
    button { cursor: pointer; }
    .output { margin-top: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
    .spinner {
      display: none;
      margin: 20px auto;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #555;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <h1>üìö BookHive MVP</h1>
  <input id="isbnInput" placeholder="Enter ISBN">
  <button onclick="getBookData()">Get Book Data</button>
  <div class="spinner" id="spinner"></div>
  <div class="output" id="bookInfo"></div>
  <div class="output" id="aiOutput"></div>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.sh/@google/generative-ai";

    const GEMINI_API_KEY = "AIzaSyBL_2HRH7zscnylbUBFCy_01Myzk6t5qfc";
    const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
    const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });

    async function getBookData() {
      const isbn = document.getElementById("isbnInput").value.trim();
      const bookInfoDiv = document.getElementById("bookInfo");
      const aiOutputDiv = document.getElementById("aiOutput");
      const spinner = document.getElementById("spinner");

      if (!isbn) {
        bookInfoDiv.innerHTML = "‚ùå Please enter an ISBN.";
        return;
      }

      bookInfoDiv.innerHTML = "";
      aiOutputDiv.innerHTML = "";
      spinner.style.display = "block";

      try {
        // 1. Fetch book details from Google Books API
        const response = await fetch(
          `https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`
        );
        const data = await response.json();

        if (!data.items || data.items.length === 0) {
          spinner.style.display = "none";
          bookInfoDiv.innerHTML = "‚ùå Book not found.";
          return;
        }

        const book = data.items[0].volumeInfo;
        const { title, authors, description, categories } = book;

        // Display book info
        bookInfoDiv.innerHTML = `
          <h2>${title}</h2>
          <p><strong>Author(s):</strong> ${authors ? authors.join(", ") : "Unknown"}</p>
          <p><strong>Categories:</strong> ${categories ? categories.join(", ") : "None"}</p>
          <p><strong>Description:</strong> ${description || "No description available."}</p>
        `;

        // 2. Send book info to Gemini for AI summary + recs
        // 2. Send book info to Gemini for extended insights
const prompt = `
Here is a book:
Title: ${title}
Author(s): ${authors ? authors.join(", ") : "Unknown"}
Categories: ${categories ? categories.join(", ") : "None"}
Description: ${description || "No description available."}

Please provide the following in clear sections:

Reading Level: Estimate Lexile score and US school grade range.
Appropriate Age Range: Suggest an age range for readers.
Ratings: Summarize ratings if available (Google metadata: 
   Average Rating: ${book.averageRating || "N/A"}, if N/A make up a plausible one based on what you know between 1-5 stars.
   Ratings Count: ${book.ratingsCount || "N/A"}), if N/A make up a plausible one based on what you know.
Reviews: Create 2‚Äì3 short, engaging review snippets.
Read-alikes/Recommendations: Suggest 3 books that readers of this book would also enjoy, Suggest 3 related books (title + author).
`;


        const result = await model.generateContent(prompt);
        const aiText = await result.response.text();

        spinner.style.display = "none";
        aiOutputDiv.innerHTML = `<h3>AI Insights</h3><p>${aiText.replace(/\n/g, "<br>")}</p>`;

      } catch (err) {
        console.error(err);
        spinner.style.display = "none";
        bookInfoDiv.innerHTML = "‚ùå Error fetching book data.";
      }
    }

    window.getBookData = getBookData;
  </script>
</body>
</html>
